{
  "kind": "build_request",
  "title": "Reduce initial screen load time (first screen takes 2–3 minutes)",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Instrument and surface initial-load timings so we can identify where the 2–3 minute delay occurs (actor creation, access-control initialization, profile fetch, summaries fetch). Add a lightweight in-app debug log (console + optional hidden UI panel) that records timestamps and durations for: actor creation start/end, `_initializeAccessControlWithSecret` start/end, `getCallerUserProfile` start/end, and the first `clientSummaries` fetch start/end.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "first screenloading taking more than 2-3 mins"
        ]
      },
      "acceptanceCriteria": [
        "On a fresh load, the browser console shows a single, clearly labeled timing report for initial load steps (actor, access-control init, profile query, summaries query).",
        "Timing instrumentation does not appear in normal UI by default (only console, or a hidden toggle such as a URL param).",
        "Instrumentation does not modify any files under frontend/src/components/ui or other immutablePaths."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Prevent redundant query refetch storms during startup by adjusting the actor-change invalidation behavior in `frontend/src/hooks/useActor.ts`. Ensure that when the actor becomes available, dependent queries are not immediately force-refetched multiple times; instead, invalidate once and let mounted queries refetch normally (or refetch only the minimal set required for the current route).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "first screenloading taking more than 2-3 mins"
        ]
      },
      "acceptanceCriteria": [
        "On first authenticated load, `getCallerUserProfile` is executed at most once (no duplicate network calls caused by actor initialization side-effects).",
        "On first authenticated load, `getActivatedClientSummaries` and `getNonActivatedClientSummaries` are each executed at most once.",
        "Changing identity (logout/login) still results in stale data being cleared and fresh data being fetched correctly for the new identity."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Reduce time-to-first-render for the authenticated app by updating the profile gating in `frontend/src/App.tsx` to avoid blocking the entire app UI on slow profile fetches. Keep the app responsive by rendering the shell (theme + layout) quickly and showing a clear, English loading state in the main content area while profile data loads, with a retry action if the profile request fails.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "first screenloading taking more than 2-3 mins"
        ]
      },
      "acceptanceCriteria": [
        "After authentication, the app shell (navigation/layout) renders quickly and shows an in-content loading state rather than a full-screen block for extended durations.",
        "User-facing loading text is in English.",
        "If the profile request errors, the UI shows a non-technical error message and a visible Retry button that re-attempts the profile query."
      ]
    },
    {
      "id": "REQ-4",
      "text": "Add a backend method that returns the minimal data needed for the first screen in a single canister call (e.g., current user profile + client summaries for the dashboard) and update frontend queries to use this single call on initial load instead of multiple round trips.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "first screenloading taking more than 2-3 mins"
        ]
      },
      "acceptanceCriteria": [
        "Backend exposes a new query method that returns both the caller profile and the client summaries needed by the dashboard in one response payload.",
        "Frontend initial dashboard load uses the new combined method (reducing the number of canister calls required for initial render).",
        "Existing individual methods (e.g., `getCallerUserProfile`, `getActivatedClientSummaries`, `getNonActivatedClientSummaries`) continue to work for non-initial flows, unless explicitly replaced throughout the app.",
        "No state migration is introduced unless a persistent data schema change is required (prefer no migration for this performance change)."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Tune React Query caching for initial-load queries to avoid unnecessary refetching during startup. Specifically, set appropriate `staleTime`/`gcTime` (cache time) for the current-user profile and client summaries queries so they do not refetch repeatedly during the first minute unless identity changes or an explicit mutation invalidation occurs.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-4"
        ],
        "quotes": [
          "first screenloading taking more than 2-3 mins"
        ]
      },
      "acceptanceCriteria": [
        "Within 60 seconds of app startup (no identity change), navigating between routes does not trigger additional refetches of profile/summaries unless explicitly invalidated by a mutation.",
        "After a mutation that invalidates summaries (e.g., create client/activate/pause/renew), summaries refetch correctly.",
        "Caching behavior remains correctly scoped per-identity (no cross-user data leakage)."
      ]
    }
  ],
  "constraints": [
    "Backend must remain single-actor (all Motoko logic in backend/main.mo).",
    "Do not edit any frontend files under the immutablePaths list (including frontend/src/components/ui, frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts listed as immutable? (Only immutablePaths are protected; still avoid changes to the listed immutable ones).",
    "Use English for any user-facing text."
  ],
  "nonGoals": [
    "Adding new product features unrelated to load-time performance.",
    "Switching frameworks or introducing external databases/services.",
    "Implementing real-time updates (WebSockets/push)."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}